<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <h1 class="page-title">Financial Overview</h1>
      <p class="page-subtitle" *ngIf="currentUser">
        {{ getGreeting() }}, {{ currentUser.displayName || 'User' }}
      </p>
    </div>
    <div class="header-right">
      <p-select
        [options]="periods"
        [(ngModel)]="selectedPeriod"
        optionLabel="label"
        (onChange)="onPeriodChange()"
        styleClass="period-select">
      </p-select>
    </div>
  </div>

  <!-- KPI Summary Cards -->
  <div class="kpi-grid">
    <!-- Total Income -->
    <div class="kpi-card kpi-income">
      <div class="kpi-icon-wrapper income-bg">
        <i class="pi pi-arrow-up"></i>
      </div>
      <div class="kpi-content">
        <span class="kpi-label">Total Income</span>
        <ng-container *ngIf="!loadingSummary; else kpiSkeleton">
          <span class="kpi-value minted-sensitive">{{ formatCurrency(summary?.totalIncome || 0) }}</span>
        </ng-container>
      </div>
    </div>

    <!-- Total Expenses -->
    <div class="kpi-card kpi-expense">
      <div class="kpi-icon-wrapper expense-bg">
        <i class="pi pi-arrow-down"></i>
      </div>
      <div class="kpi-content">
        <span class="kpi-label">Total Expenses</span>
        <ng-container *ngIf="!loadingSummary; else kpiSkeleton">
          <span class="kpi-value minted-sensitive">{{ formatCurrency(summary?.totalExpense || 0) }}</span>
        </ng-container>
      </div>
    </div>

    <!-- Net Balance -->
    <div class="kpi-card kpi-balance">
      <div class="kpi-icon-wrapper balance-bg">
        <i class="pi pi-wallet"></i>
      </div>
      <div class="kpi-content">
        <span class="kpi-label">Net Balance</span>
        <ng-container *ngIf="!loadingSummary; else kpiSkeleton">
          <span class="kpi-value minted-sensitive" [class.positive]="(summary?.netBalance || 0) >= 0"
                [class.negative]="(summary?.netBalance || 0) < 0">
            {{ formatCurrency(summary?.netBalance || 0) }}
          </span>
        </ng-container>
      </div>
    </div>

    <!-- Transactions -->
    <div class="kpi-card kpi-count">
      <div class="kpi-icon-wrapper count-bg">
        <i class="pi pi-list"></i>
      </div>
      <div class="kpi-content">
        <span class="kpi-label">Transactions</span>
        <ng-container *ngIf="!loadingSummary; else kpiSkeleton">
          <span class="kpi-value">{{ summary?.transactionCount || 0 }}</span>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="charts-grid">
    <!-- Monthly Expenses Bar Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <h3 class="chart-title">Monthly Expenses</h3>
        <span class="chart-badge">By Category</span>
      </div>
      <div class="chart-body">
        <ng-container *ngIf="!loadingCategories; else chartSkeleton">
          <p-chart
            *ngIf="categoryData.length > 0; else emptyChart"
            type="bar"
            [data]="barChartData"
            [options]="barChartOptions"
            height="280px">
          </p-chart>
        </ng-container>
      </div>
    </div>

    <!-- Category Split Doughnut -->
    <div class="chart-card">
      <div class="chart-header">
        <h3 class="chart-title">Category Split</h3>
        <span class="chart-badge">Expense Breakdown</span>
      </div>
      <div class="chart-body">
        <ng-container *ngIf="!loadingCategories; else chartSkeleton">
          <p-chart
            *ngIf="categoryData.length > 0; else emptyChart"
            type="doughnut"
            [data]="doughnutChartData"
            [options]="doughnutChartOptions"
            height="280px">
          </p-chart>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Full-width Trend Line Chart -->
  <div class="trend-card chart-card">
    <div class="chart-header">
      <h3 class="chart-title">Income vs Expense Trend</h3>
      <span class="chart-badge">Last 6 Months</span>
    </div>
    <div class="chart-body chart-body-lg">
      <ng-container *ngIf="!loadingTrend; else chartSkeleton">
        <p-chart
          *ngIf="trendData.length > 0; else emptyChart"
          type="line"
          [data]="lineChartData"
          [options]="lineChartOptions"
          height="300px">
        </p-chart>
      </ng-container>
    </div>
  </div>
</div>

<!-- Templates -->
<ng-template #kpiSkeleton>
  <p-skeleton width="120px" height="28px" styleClass="mt-2"></p-skeleton>
</ng-template>

<ng-template #chartSkeleton>
  <div class="skeleton-chart">
    <p-skeleton width="100%" height="260px" borderRadius="8px"></p-skeleton>
  </div>
</ng-template>

<ng-template #emptyChart>
  <div class="empty-chart">
    <i class="pi pi-chart-bar empty-icon"></i>
    <p class="empty-text">No data available for this period</p>
  </div>
</ng-template>
