<p-toast></p-toast>
<p-confirmDialog key="notificationsPage"></p-confirmDialog>

<div class="p-8">
  <div class="max-w-4xl mx-auto">
    <!-- Title & Global Actions -->
    <div class="flex items-end justify-between mb-8">
      <div>
        <h2 class="text-3xl font-black tracking-tight" [style.color]="'var(--minted-text-primary)'">
          Notifications
        </h2>
        <p class="mt-1" [style.color]="'var(--minted-text-muted)'">
          Keep track of your financial movements and alerts.
        </p>
      </div>
      <div class="flex items-center gap-3">
        <button
          *ngIf="(notificationService.unreadCount$ | async) as count"
          pButton
          label="Mark all as read"
          icon="pi pi-check-circle"
          class="p-button-outlined p-button-sm"
          [style.border-color]="'var(--minted-border)'"
          [style.color]="'var(--minted-text-secondary)'"
          (click)="markAllAsRead()">
        </button>
        <button
          pButton
          label="Clear all"
          icon="pi pi-trash"
          class="p-button-text p-button-sm p-button-danger"
          (click)="clearAll()">
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="space-y-4">
      <p-skeleton width="100%" height="80px" borderRadius="12px"></p-skeleton>
      <p-skeleton width="100%" height="80px" borderRadius="12px"></p-skeleton>
      <p-skeleton width="100%" height="80px" borderRadius="12px"></p-skeleton>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="!loading && groups.length === 0"
      class="flex flex-col items-center justify-center py-20 text-center">
      <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6"
           [style.background-color]="'var(--minted-accent-subtle)'">
        <i class="pi pi-check text-5xl" [style.color]="'var(--minted-accent)'"></i>
      </div>
      <h3 class="text-xl font-bold" [style.color]="'var(--minted-text-primary)'">All caught up!</h3>
      <p class="mt-2 max-w-xs mx-auto" [style.color]="'var(--minted-text-muted)'">
        You've seen all your notifications. Enjoy your organized financial life!
      </p>
      <button pButton label="Back to Dashboard" class="mt-8"
              [style.background-color]="'var(--minted-accent)'"
              [style.border-color]="'var(--minted-accent)'"
              routerLink="/">
      </button>
    </div>

    <!-- Notification Groups -->
    <div *ngIf="!loading && groups.length > 0" class="space-y-10">
      <section *ngFor="let group of groups">
        <!-- Section Header -->
        <div class="flex items-center gap-4 mb-4">
          <h3 class="text-sm font-bold uppercase tracking-widest flex-shrink-0"
              [style.color]="'var(--minted-text-muted)'">
            {{ group.label }}
          </h3>
          <div class="h-px w-full" [style.background-color]="'var(--minted-border)'"></div>
        </div>

        <!-- Cards -->
        <div class="space-y-3">
          <div
            *ngFor="let n of group.notifications"
            class="group relative rounded-xl border p-4 flex items-start gap-4 transition-all cursor-pointer"
            [style.background-color]="'var(--minted-bg-card)'"
            [style.border-color]="'var(--minted-border-light)'"
            [class.shadow-sm]="true"
            (click)="onNotificationClick(n)">

            <!-- Unread accent bar -->
            <div *ngIf="!n.isRead"
                 class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 rounded-r-full"
                 [style.background-color]="'var(--minted-accent)'">
            </div>

            <!-- Type icon -->
            <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0"
                 [style.background-color]="getNotificationBg(n.type)">
              <i [class]="getNotificationIcon(n.type)" [style.color]="getNotificationColor(n.type)"></i>
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <div class="flex justify-between items-start">
                <h4 class="text-base truncate"
                    [style.color]="'var(--minted-text-primary)'"
                    [class.font-bold]="!n.isRead"
                    [class.font-medium]="n.isRead">
                  {{ n.title }}
                </h4>
                <span class="text-xs font-medium tracking-tight flex-shrink-0 ml-2"
                      [style.color]="'var(--minted-text-muted)'">
                  {{ getRelativeTime(n.createdAt) }}
                </span>
              </div>
              <p class="text-sm mt-0.5" [style.color]="'var(--minted-text-secondary)'">
                {{ n.message }}
              </p>
            </div>

            <!-- Dismiss button (visible on hover) -->
            <button
              class="opacity-0 group-hover:opacity-100 p-1.5 rounded-lg transition-all flex-shrink-0"
              [style.color]="'var(--minted-text-muted)'"
              pTooltip="Dismiss"
              tooltipPosition="left"
              (click)="dismiss($event, n.id)">
              <i class="pi pi-times text-lg"></i>
            </button>
          </div>
        </div>
      </section>

      <!-- Load More -->
      <div *ngIf="notificationService.hasMore" class="text-center pt-4">
        <button pButton label="Load more notifications"
                class="p-button-outlined p-button-sm"
                [style.border-color]="'var(--minted-border)'"
                [style.color]="'var(--minted-text-secondary)'"
                (click)="loadMore()">
        </button>
      </div>
    </div>
  </div>
</div>
