<div class="p-4 sm:p-8">
  <!-- Header & Main Actions -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-bold" style="color: var(--minted-text-primary);">Transactions</h1>
      <p class="text-sm mt-1" style="color: var(--minted-text-muted);">Manage and categorize your financial activity.
      </p>
    </div>
    <div class="flex gap-3 items-center">
      <!-- Bulk action buttons (visible when rows selected) -->
      <span *ngIf="selectedTransactions.length > 0" class="text-sm font-medium px-2 py-1 rounded-full"
        style="background-color: var(--minted-accent-subtle); color: var(--minted-accent);">
        {{ selectedTransactions.length }} selected
      </span>
      <button *ngIf="selectedTransactions.length > 0" pButton type="button" label="Delete Selected" icon="pi pi-trash"
        class="p-button-danger p-button-outlined p-button-sm" (click)="bulkDelete()">
      </button>
      <button *ngIf="selectedTransactions.length > 0" pButton type="button" label="Change Category" icon="pi pi-tags"
        class="p-button-outlined p-button-sm" (click)="openBulkCategoryDialog()">
      </button>
      <button pButton type="button" label="Export" icon="pi pi-download" class="p-button-outlined"
        (click)="exportTransactions()" [disabled]="filteredTransactions.length === 0">
      </button>
      <button pButton type="button" label="Add Transaction" icon="pi pi-plus" (click)="openNewDialog()"
        style="background-color: var(--minted-accent); border-color: var(--minted-accent);">
      </button>
    </div>
  </div>

  <!-- Filters & Controls Bar -->
  <div class="rounded-xl shadow-sm border p-4 mb-6"
    style="background-color: var(--minted-bg-card); border-color: var(--minted-border);">
    <div class="flex flex-col gap-4">
      <!-- Date Filters Row -->
      <div class="flex flex-col lg:flex-row gap-4 justify-between items-start lg:items-center">
        <!-- Quick Date Filters -->
        <div class="flex flex-wrap gap-2">
          <button type="button" class="px-3 py-1.5 text-sm font-medium rounded-full transition-colors"
            [class.bg-primary\/10]="selectedDateFilter === DateFilterOption.THIS_MONTH"
            [class.text-primary]="selectedDateFilter === DateFilterOption.THIS_MONTH"
            [class.border]="selectedDateFilter === DateFilterOption.THIS_MONTH"
            [class.border-primary\/20]="selectedDateFilter === DateFilterOption.THIS_MONTH"
            [style.color]="selectedDateFilter !== DateFilterOption.THIS_MONTH ? 'var(--minted-text-secondary)' : null"
            (click)="onDateFilterChange(DateFilterOption.THIS_MONTH)">
            This Month
          </button>
          <button type="button" class="px-3 py-1.5 text-sm font-medium rounded-full transition-colors"
            [class.bg-primary\/10]="selectedDateFilter === DateFilterOption.LAST_MONTH"
            [class.text-primary]="selectedDateFilter === DateFilterOption.LAST_MONTH"
            [class.border]="selectedDateFilter === DateFilterOption.LAST_MONTH"
            [class.border-primary\/20]="selectedDateFilter === DateFilterOption.LAST_MONTH"
            [style.color]="selectedDateFilter !== DateFilterOption.LAST_MONTH ? 'var(--minted-text-secondary)' : null"
            (click)="onDateFilterChange(DateFilterOption.LAST_MONTH)">
            Last Month
          </button>
          <button type="button" class="px-3 py-1.5 text-sm font-medium rounded-full transition-colors"
            [class.bg-primary\/10]="selectedDateFilter === DateFilterOption.LAST_3_MONTHS"
            [class.text-primary]="selectedDateFilter === DateFilterOption.LAST_3_MONTHS"
            [class.border]="selectedDateFilter === DateFilterOption.LAST_3_MONTHS"
            [class.border-primary\/20]="selectedDateFilter === DateFilterOption.LAST_3_MONTHS"
            [style.color]="selectedDateFilter !== DateFilterOption.LAST_3_MONTHS ? 'var(--minted-text-secondary)' : null"
            (click)="onDateFilterChange(DateFilterOption.LAST_3_MONTHS)">
            Last 3 Months
          </button>
          <button type="button" class="px-3 py-1.5 text-sm font-medium rounded-full transition-colors"
            [class.bg-primary\/10]="selectedDateFilter === DateFilterOption.LAST_6_MONTHS"
            [class.text-primary]="selectedDateFilter === DateFilterOption.LAST_6_MONTHS"
            [class.border]="selectedDateFilter === DateFilterOption.LAST_6_MONTHS"
            [class.border-primary\/20]="selectedDateFilter === DateFilterOption.LAST_6_MONTHS"
            [style.color]="selectedDateFilter !== DateFilterOption.LAST_6_MONTHS ? 'var(--minted-text-secondary)' : null"
            (click)="onDateFilterChange(DateFilterOption.LAST_6_MONTHS)">
            Last 6 Months
          </button>
          <button type="button" class="px-3 py-1.5 text-sm font-medium rounded-full transition-colors"
            [class.bg-primary\/10]="selectedDateFilter === DateFilterOption.LAST_YEAR"
            [class.text-primary]="selectedDateFilter === DateFilterOption.LAST_YEAR"
            [class.border]="selectedDateFilter === DateFilterOption.LAST_YEAR"
            [class.border-primary\/20]="selectedDateFilter === DateFilterOption.LAST_YEAR"
            [style.color]="selectedDateFilter !== DateFilterOption.LAST_YEAR ? 'var(--minted-text-secondary)' : null"
            (click)="onDateFilterChange(DateFilterOption.LAST_YEAR)">
            Last Year
          </button>
          <button type="button"
            class="px-3 py-1.5 text-sm font-medium rounded-full transition-colors flex items-center gap-1"
            [class.bg-primary\/10]="selectedDateFilter === DateFilterOption.CUSTOM"
            [class.text-primary]="selectedDateFilter === DateFilterOption.CUSTOM"
            [class.border]="selectedDateFilter === DateFilterOption.CUSTOM"
            [class.border-primary\/20]="selectedDateFilter === DateFilterOption.CUSTOM"
            [style.color]="selectedDateFilter !== DateFilterOption.CUSTOM ? 'var(--minted-text-secondary)' : null"
            (click)="onDateFilterChange(DateFilterOption.CUSTOM)">
            Custom Range <i class="pi pi-calendar text-sm"></i>
          </button>
        </div>

        <!-- Dropdowns & Search -->
        <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto items-start">
          <p-select [(ngModel)]="selectedAccountId" [options]="accountOptions" optionLabel="label" optionValue="value"
            placeholder="All Accounts" (onChange)="onAccountFilterChange()" appendTo="body" styleClass="w-full sm:w-48">
          </p-select>

          <p-select [(ngModel)]="selectedCategoryId" [options]="categoryOptions" optionLabel="label" optionValue="value"
            placeholder="All Categories" (onChange)="onCategoryFilterChange()" appendTo="body" styleClass="w-full sm:w-48">
          </p-select>

          <p-iconfield iconPosition="left" class="w-full sm:w-64">
            <p-inputicon styleClass="pi pi-search" />
            <input pInputText type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
              placeholder="Search transactions..." class="w-full" />
          </p-iconfield>
        </div>
      </div>

      <!-- Custom Date Range Pickers (shown when Custom Range is selected) -->
      <div *ngIf="showCustomDatePickers" class="flex flex-col sm:flex-row gap-4 items-end pt-2 border-t"
        style="border-color: var(--minted-border);">
        <div class="flex-1">
          <label for="startDate" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Start Date</label>
          <p-datepicker id="startDate" [(ngModel)]="customStartDate" (ngModelChange)="onCustomDateChange()"
            dateFormat="mm/dd/yy" [showIcon]="true" placeholder="Select start date" appendTo="body"
            styleClass="w-full" inputStyleClass="w-full">
          </p-datepicker>
        </div>
        <div class="flex-1">
          <label for="endDate" class="block text-sm font-medium mb-2" style="color: var(--minted-text-secondary);">End
            Date</label>
          <p-datepicker id="endDate" [(ngModel)]="customEndDate" (ngModelChange)="onCustomDateChange()"
            dateFormat="mm/dd/yy" [showIcon]="true" placeholder="Select end date" appendTo="body"
            styleClass="w-full" inputStyleClass="w-full">
          </p-datepicker>
        </div>
      </div>
    </div>
  </div>

  <!-- AG Grid Table -->
  <div class="shadow-sm">
    <ag-grid-angular style="width: 100%; height: 600px;" [rowData]="rowData" [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef" [gridOptions]="gridOptions" [loading]="loading" [theme]="mintedTheme"
      (gridReady)="onGridReady($event)" (selectionChanged)="onSelectionChanged()">
    </ag-grid-angular>
  </div>
</div>

<!-- Transaction Dialog -->
<p-dialog [(visible)]="showDialog" [header]="isEditMode ? 'Edit Transaction' : 'Add Transaction'" [modal]="true"
  [style]="{width: '600px'}" [draggable]="false" [resizable]="false">

  <form *ngIf="transactionForm" [formGroup]="transactionForm" (ngSubmit)="saveTransaction()">
    <div class="space-y-4">
      <!-- Amount and Type Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="amount" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Amount</label>
          <p-inputNumber id="amount" formControlName="amount" mode="currency"
            [currency]="currencyService.currentCurrency" [locale]="currencyService.currentLocale"
            [minFractionDigits]="2" styleClass="w-full" inputStyleClass="w-full"
            [class.p-invalid]="transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched">
          </p-inputNumber>
          <small class="p-error block mt-1"
            *ngIf="transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched">
            Amount is required and must be greater than 0
          </small>
        </div>

        <div>
          <label for="type" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Type</label>
          <p-select id="type" formControlName="type" [options]="transactionTypes" optionLabel="label" optionValue="value"
            placeholder="Select type" appendTo="body" styleClass="w-full"
            [class.p-invalid]="transactionForm.get('type')?.invalid && transactionForm.get('type')?.touched">
          </p-select>
          <small class="p-error block mt-1"
            *ngIf="transactionForm.get('type')?.invalid && transactionForm.get('type')?.touched">
            Type is required
          </small>
        </div>
      </div>

      <!-- Description -->
      <div>
        <label for="description" class="block text-sm font-medium mb-2"
          style="color: var(--minted-text-secondary);">Description</label>
        <input pInputText id="description" formControlName="description" placeholder="Enter description" class="w-full"
          [class.p-invalid]="transactionForm.get('description')?.invalid && transactionForm.get('description')?.touched" />
        <small class="p-error block mt-1"
          *ngIf="transactionForm.get('description')?.invalid && transactionForm.get('description')?.touched">
          Description is required (max 500 characters)
        </small>
      </div>

      <!-- Date and Category Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="transactionDate" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Date</label>
          <p-datepicker id="transactionDate" formControlName="transactionDate" dateFormat="mm/dd/yy" [showIcon]="true"
            styleClass="w-full" inputStyleClass="w-full"
            [class.p-invalid]="transactionForm.get('transactionDate')?.invalid && transactionForm.get('transactionDate')?.touched">
          </p-datepicker>
          <small class="p-error block mt-1"
            *ngIf="transactionForm.get('transactionDate')?.invalid && transactionForm.get('transactionDate')?.touched">
            Date is required
          </small>
        </div>

        <div>
          <label for="categoryId" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Category</label>
          <p-select id="categoryId" formControlName="categoryId" [options]="categories" optionLabel="name"
            optionValue="id" placeholder="Select category" appendTo="body" styleClass="w-full"
            [class.p-invalid]="transactionForm.get('categoryId')?.invalid && transactionForm.get('categoryId')?.touched">
          </p-select>
          <small class="p-error block mt-1"
            *ngIf="transactionForm.get('categoryId')?.invalid && transactionForm.get('categoryId')?.touched">
            Category is required
          </small>
        </div>
      </div>

      <!-- Account and To Account Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="accountId" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Account</label>
          <p-select id="accountId" formControlName="accountId" [options]="accounts" optionLabel="name" optionValue="id"
            placeholder="Select account" appendTo="body" styleClass="w-full"
            [class.p-invalid]="transactionForm.get('accountId')?.invalid && transactionForm.get('accountId')?.touched">
          </p-select>
          <small class="p-error block mt-1"
            *ngIf="transactionForm.get('accountId')?.invalid && transactionForm.get('accountId')?.touched">
            Account is required
          </small>
        </div>

        <div>
          <label for="toAccountId" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">To Account (Transfer)</label>
          <p-select id="toAccountId" formControlName="toAccountId" [options]="toAccountOptions" optionLabel="label"
            optionValue="value" placeholder="Select account" appendTo="body" styleClass="w-full">
          </p-select>
        </div>
      </div>

      <!-- Notes -->
      <div>
        <label for="notes" class="block text-sm font-medium mb-2"
          style="color: var(--minted-text-secondary);">Notes</label>
        <textarea pInputTextarea id="notes" formControlName="notes" rows="3" placeholder="Add notes (optional)"
          class="w-full">
        </textarea>
      </div>

      <!-- Tags and Recurring Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="tags" class="block text-sm font-medium mb-2"
            style="color: var(--minted-text-secondary);">Tags</label>
          <input pInputText id="tags" formControlName="tags" placeholder="Enter tags (comma separated)"
            class="w-full" />
        </div>

        <div class="flex items-end pb-2">
          <div class="flex flex-col gap-3">
            <div class="flex items-center gap-2">
              <p-checkbox formControlName="isRecurring" [binary]="true" inputId="isRecurring">
              </p-checkbox>
              <label for="isRecurring" class="text-sm font-medium cursor-pointer"
                style="color: var(--minted-text-secondary);">
                Recurring Transaction
              </label>
            </div>
            <div class="flex items-center gap-2">
              <p-checkbox formControlName="excludeFromAnalysis" [binary]="true" inputId="excludeFromAnalysis">
              </p-checkbox>
              <label for="excludeFromAnalysis" class="text-sm font-medium cursor-pointer"
                style="color: var(--minted-text-secondary);">
                Exclude from Analysis
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-3 mt-6 pt-4 border-t" style="border-color: var(--minted-border);">
      <button pButton type="button" label="Cancel" class="p-button-text" (click)="showDialog = false">
      </button>
      <button pButton type="button" label="Delete" class="p-button-danger p-button-outlined"
        *ngIf="isEditMode && selectedTransaction" (click)="deleteTransaction(selectedTransaction)">
      </button>
      <button pButton type="submit" [label]="isEditMode ? 'Update' : 'Create'" [disabled]="transactionForm.invalid"
        style="background-color: var(--minted-accent); border-color: var(--minted-accent);">
      </button>
    </div>
  </form>
</p-dialog>

<!-- ═══════ Split Transaction Dialog ═══════ -->
<p-dialog
  [(visible)]="showSplitDialog"
  header="Split Transaction"
  [modal]="true"
  [style]="{ width: '640px', maxHeight: '90vh' }"
  [closable]="true"
  [draggable]="false"
  (onHide)="onSplitDialogHide()">
  <form *ngIf="splitForm" [formGroup]="splitForm" (ngSubmit)="saveSplit()">
    <div class="space-y-5">
      <!-- Description -->
      <div>
        <label class="block text-sm font-medium mb-1" style="color: var(--minted-text-secondary);">Description *</label>
        <input pInputText formControlName="description" class="w-full" placeholder="What was this for?" />
        <small class="text-red-500" *ngIf="splitForm.get('description')?.invalid && splitForm.get('description')?.touched">
          Description is required
        </small>
      </div>

      <!-- Category + Amount -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1" style="color: var(--minted-text-secondary);">Category *</label>
          <input pInputText formControlName="categoryName" class="w-full" placeholder="e.g. Dining" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" style="color: var(--minted-text-secondary);">Total Amount *</label>
          <p-inputNumber formControlName="totalAmount" [minFractionDigits]="2" [maxFractionDigits]="2"
            [min]="0.01" class="w-full" placeholder="0.00"
            (onInput)="onTotalAmountChange()">
          </p-inputNumber>
        </div>
      </div>

      <!-- Date -->
      <div>
        <label class="block text-sm font-medium mb-1" style="color: var(--minted-text-secondary);">Date *</label>
        <p-datepicker formControlName="transactionDate" [showIcon]="true" dateFormat="yy-mm-dd"
          styleClass="w-full">
        </p-datepicker>
      </div>

      <hr style="border-color: var(--minted-border);" />

      <!-- Split Type -->
      <div>
        <label class="block text-sm font-medium mb-3" style="color: var(--minted-text-secondary);">Split Type</label>
        <div class="grid grid-cols-3 gap-3">
          <div class="cursor-pointer" (click)="onSplitTypeChange('EQUAL')">
            <div class="flex flex-col items-center justify-center p-3 rounded-lg border transition-all"
              [style.background-color]="selectedSplitType === 'EQUAL' ? 'var(--minted-accent-subtle)' : 'var(--minted-bg-surface)'"
              [style.border-color]="selectedSplitType === 'EQUAL' ? 'var(--minted-accent)' : 'var(--minted-border)'"
              [style.color]="selectedSplitType === 'EQUAL' ? 'var(--minted-accent)' : 'var(--minted-text-muted)'">
              <i class="pi pi-equals mb-1 text-lg"></i>
              <span class="text-sm font-medium">Equal</span>
            </div>
          </div>
          <div class="cursor-pointer" (click)="onSplitTypeChange('UNEQUAL')">
            <div class="flex flex-col items-center justify-center p-3 rounded-lg border transition-all"
              [style.background-color]="selectedSplitType === 'UNEQUAL' ? 'var(--minted-accent-subtle)' : 'var(--minted-bg-surface)'"
              [style.border-color]="selectedSplitType === 'UNEQUAL' ? 'var(--minted-accent)' : 'var(--minted-border)'"
              [style.color]="selectedSplitType === 'UNEQUAL' ? 'var(--minted-accent)' : 'var(--minted-text-muted)'">
              <i class="pi pi-chart-pie mb-1 text-lg"></i>
              <span class="text-sm font-medium">Unequal</span>
            </div>
          </div>
          <div class="cursor-pointer" (click)="onSplitTypeChange('SHARE')">
            <div class="flex flex-col items-center justify-center p-3 rounded-lg border transition-all"
              [style.background-color]="selectedSplitType === 'SHARE' ? 'var(--minted-accent-subtle)' : 'var(--minted-bg-surface)'"
              [style.border-color]="selectedSplitType === 'SHARE' ? 'var(--minted-accent)' : 'var(--minted-border)'"
              [style.color]="selectedSplitType === 'SHARE' ? 'var(--minted-accent)' : 'var(--minted-text-muted)'">
              <i class="pi pi-percentage mb-1 text-lg"></i>
              <span class="text-sm font-medium">By Share</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Split With Friends -->
      <div>
        <div class="flex items-center justify-between mb-3">
          <label class="block text-sm font-medium" style="color: var(--minted-text-secondary);">Split with friends</label>
        </div>
        <div class="space-y-3">
          <!-- Entries -->
          <div *ngFor="let entry of splitFriendEntries; let i = index"
            class="flex items-center gap-3 p-3 rounded-lg border"
            [style.background-color]="entry.friendId === null ? 'var(--minted-accent-subtle)' : 'var(--minted-bg-surface)'"
            [style.border-color]="entry.friendId === null ? 'var(--minted-accent)' : 'var(--minted-border)'">
            <!-- Avatar -->
            <div class="h-10 w-10 rounded-full flex items-center justify-center font-bold text-sm shrink-0 text-white"
              [style.background-color]="entry.avatarColor">
              {{ entry.friendId === null ? 'ME' : getInitials(entry.friendName) }}
            </div>
            <!-- Name -->
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium truncate" style="color: var(--minted-text-primary);">
                {{ entry.friendId === null ? 'You (Payer)' : entry.friendName }}
              </p>
              <p *ngIf="entry.friendId === null" class="text-xs" style="color: var(--minted-text-muted);">Paying full amount</p>
            </div>
            <!-- Amount -->
            <div class="flex items-center gap-3">
              <div *ngIf="selectedSplitType === 'EQUAL'" class="text-right">
                <p class="text-sm font-bold" style="color: var(--minted-text-primary);">{{ currencyService.format(entry.shareAmount) }}</p>
              </div>
              <input *ngIf="selectedSplitType === 'UNEQUAL'" type="number" step="0.01" [min]="0"
                class="w-24 px-2 py-1 rounded text-sm text-right"
                style="background-color: var(--minted-bg-input); color: var(--minted-text-primary); border: 1px solid var(--minted-border);"
                [(ngModel)]="entry.shareAmount" [ngModelOptions]="{ standalone: true }" />
              <div *ngIf="selectedSplitType === 'SHARE'" class="flex items-center gap-2">
                <input type="number" step="0.01" [min]="0" [max]="100"
                  class="w-16 px-2 py-1 rounded text-sm text-right"
                  style="background-color: var(--minted-bg-input); color: var(--minted-text-primary); border: 1px solid var(--minted-border);"
                  [(ngModel)]="entry.sharePercentage" [ngModelOptions]="{ standalone: true }"
                  (ngModelChange)="onSharePercentageChange(i)" />
                <span class="text-xs" style="color: var(--minted-text-muted);">%</span>
                <span class="text-xs" style="color: var(--minted-text-secondary);">{{ currencyService.format(entry.shareAmount) }}</span>
              </div>
              <!-- Remove button (not for "Me") -->
              <button *ngIf="entry.friendId !== null" type="button"
                class="p-1 transition-colors hover:text-red-500"
                style="color: var(--minted-text-muted);"
                (click)="removeFriendFromSplit(i)">
                <i class="pi pi-times text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Add friend placeholder -->
          <div *ngIf="availableFriendsForSplit.length > 0"
            class="border border-dashed rounded-lg p-3"
            style="border-color: var(--minted-border);">
            <p class="text-xs mb-2" style="color: var(--minted-text-muted);">Add a friend:</p>
            <div class="flex flex-wrap gap-2">
              <button *ngFor="let f of availableFriendsForSplit" type="button"
                class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium border hover:border-green-400 hover:bg-green-50 transition-colors"
                style="background-color: var(--minted-bg-card); border-color: var(--minted-border); color: var(--minted-text-primary);"
                (click)="addFriendToSplit(f)">
                <div class="w-5 h-5 rounded-full flex items-center justify-center text-white text-[9px] font-bold"
                  [style.background-color]="f.avatarColor">
                  {{ getInitials(f.name) }}
                </div>
                {{ f.name }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Box -->
      <div class="p-4 rounded-lg flex justify-between items-center"
        style="background-color: var(--minted-bg-surface); border: 1px solid var(--minted-border);">
        <span class="text-sm font-medium" style="color: var(--minted-text-muted);">Total Split</span>
        <span class="text-lg font-bold" style="color: var(--minted-text-primary);">
          {{ currencyService.format(getSplitTotal()) }}
          <span *ngIf="splitForm.get('totalAmount')?.value" class="text-xs font-normal ml-1"
            style="color: var(--minted-text-muted);">
            of {{ currencyService.format(splitForm.get('totalAmount')?.value) }}
          </span>
        </span>
      </div>
    </div>

    <div class="flex justify-end gap-3 mt-6">
      <button pButton type="button" class="p-button-text" (click)="showSplitDialog = false">Cancel</button>
      <button pButton type="submit">
        <i class="pi pi-sitemap mr-2"></i>
        Add to Splits
      </button>
    </div>
  </form>
</p-dialog>

<!-- Bulk Category Dialog -->
<p-dialog [(visible)]="showBulkCategoryDialog" header="Change Category" [modal]="true"
  [style]="{width: '400px'}" [draggable]="false" [resizable]="false">
  <div class="space-y-4">
    <p class="text-sm" style="color: var(--minted-text-secondary);">
      Select a new category for {{ selectedTransactions.length }} selected transaction(s).
    </p>
    <div>
      <label class="block text-sm font-medium mb-2" style="color: var(--minted-text-secondary);">Category</label>
      <p-select [(ngModel)]="bulkCategoryId" [options]="categories" optionLabel="name" optionValue="id"
        placeholder="Select category" appendTo="body" styleClass="w-full">
      </p-select>
    </div>
  </div>
  <div class="flex justify-end gap-3 mt-6 pt-4 border-t" style="border-color: var(--minted-border);">
    <button pButton type="button" label="Cancel" class="p-button-text" (click)="showBulkCategoryDialog = false">
    </button>
    <button pButton type="button" label="Update" [disabled]="!bulkCategoryId" (click)="saveBulkCategory()"
      style="background-color: var(--minted-accent); border-color: var(--minted-accent);">
    </button>
  </div>
</p-dialog>

<!-- Confirmation Dialog -->
<p-confirmDialog key="transactions"></p-confirmDialog>

<!-- Toast Messages -->
<p-toast></p-toast>