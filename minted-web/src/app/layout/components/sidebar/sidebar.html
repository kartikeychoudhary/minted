<aside
  [class]="isOpen ? 'w-64' : 'w-20'"
  class="h-screen flex-shrink-0 text-white flex flex-col transition-all duration-300 bg-[#166534] relative">

  <!-- Logo Area -->
  <div class="h-16 flex items-center border-b border-white/10" [class.px-6]="isOpen" [class.justify-center]="!isOpen" [class.px-4]="!isOpen">
    <div class="flex items-center gap-2" [class.justify-center]="!isOpen">
      <span class="material-icons text-primary text-3xl">account_balance_wallet</span>
      <span *ngIf="isOpen" class="text-xl font-bold tracking-tight">Minted</span>
    </div>
  </div>

  <!-- Toggle Button -->
  <button
    type="button"
    (click)="toggleSidebar()"
    class="absolute -right-3 top-20 bg-white text-gray-600 rounded-full p-1.5 shadow-lg hover:bg-gray-50 transition-colors z-10 border border-gray-200"
    [attr.aria-label]="isOpen ? 'Collapse sidebar' : 'Expand sidebar'"
    pTooltip="{{ isOpen ? 'Collapse' : 'Expand' }}"
    tooltipPosition="right">
    <span class="material-icons text-sm">{{ isOpen ? 'chevron_left' : 'chevron_right' }}</span>
  </button>

  <!-- Navigation Links -->
  <nav class="flex-1 overflow-y-auto py-6 space-y-1" [class.px-3]="isOpen" [class.px-2]="!isOpen">
    <ng-container *ngFor="let item of navigationItems">
      <!-- Section Header -->
      <div *ngIf="item.section && isOpen" class="pt-4 pb-2">
        <p class="px-3 text-xs font-semibold text-white/40 uppercase tracking-wider">{{ item.section }}</p>
      </div>

      <!-- Separator for section in collapsed mode -->
      <div *ngIf="item.section && !isOpen" class="h-px bg-white/10 my-2 mx-2"></div>

      <!-- Navigation Link -->
      <a
        [routerLink]="item.route"
        routerLinkActive="bg-white/10 text-white shadow-sm border border-white/5"
        [routerLinkActiveOptions]="{ exact: item.route === '/' }"
        class="flex items-center rounded-lg text-white/70 hover:text-white hover:bg-white/10 transition-colors group"
        [class.px-3]="isOpen"
        [class.py-2.5]="isOpen"
        [class.gap-3]="isOpen"
        [class.justify-center]="!isOpen"
        [class.p-3]="!isOpen"
        [pTooltip]="!isOpen ? item.label : ''"
        tooltipPosition="right">
        <span
          class="material-icons text-xl transition-colors"
          [class.text-primary]="isActive(item.route)"
          [class.group-hover:text-primary]="!isActive(item.route)">
          {{ item.icon }}
        </span>
        <span *ngIf="isOpen" class="font-medium">{{ item.label }}</span>
      </a>
    </ng-container>
  </nav>

  <!-- User Profile Section -->
  <div class="p-4 border-t border-white/10 relative">
    <div
      (click)="toggleUserMenu()"
      class="flex items-center rounded-lg hover:bg-white/5 cursor-pointer transition-colors"
      [class.gap-3]="isOpen"
      [class.p-2]="isOpen"
      [class.justify-center]="!isOpen"
      [class.p-3]="!isOpen"
      [pTooltip]="!isOpen ? currentUser?.displayName : ''"
      tooltipPosition="right">

      <!-- Avatar -->
      <div
        class="rounded-full border-2 border-[#166534]/50 flex items-center justify-center font-semibold text-white"
        [class.w-9]="isOpen"
        [class.h-9]="isOpen"
        [class.w-10]="!isOpen"
        [class.h-10]="!isOpen"
        [style.background-color]="'#c48821'">
        {{ getInitials(currentUser?.displayName || 'U') }}
      </div>

      <!-- User Info (shown when open) -->
      <div *ngIf="isOpen" class="flex-1 min-w-0">
        <p class="text-sm font-medium text-white truncate">{{ currentUser?.displayName }}</p>
        <p class="text-xs text-white/50 truncate">{{ currentUser?.email }}</p>
      </div>

      <!-- Dropdown Icon (shown when open) -->
      <span *ngIf="isOpen" class="material-icons text-white/40 text-lg">expand_more</span>
    </div>

    <!-- User Menu Dropdown -->
    <div
      *ngIf="showUserMenu && isOpen"
      class="absolute bottom-full left-4 right-4 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden">
      <button
        type="button"
        (click)="navigateToProfile()"
        class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors">
        <span class="material-icons text-gray-500 text-lg">person</span>
        <span>Profile Settings</span>
      </button>
      <button
        type="button"
        (click)="logout()"
        class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors border-t border-gray-100">
        <span class="material-icons text-red-600 text-lg">logout</span>
        <span>Logout</span>
      </button>
    </div>
  </div>
</aside>
